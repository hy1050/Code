#include <Arduino.h>
#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>
#include <Intro.h>
#include <control.h>
#include <Wire.h>
#include <FS.h>

/*Put WiFi SSID & Password*/
// const char *ssid = "Hong Chau";    // Enter SSID here
// const char *password = "020274tc"; // Enter Password here
// const char *ssid = "TP-Link_12C2";    // Enter SSID here
// const char *password = "83211720"; // Enter Password here

// const char* ssid = "f'(x)=3-5sinx,f(0)=10,f(x)=?";
// const char* password = "3x+5cosx+5";

const char* ssid = "Hello";
const char* password = "khongcho";
//----------------------------------------

ESP8266WebServer server(80); //--> Server on port 80

//----------------------------------------
String Incoming_Text = ""; //--> Variable to hold the text that is sent from a web server (web page)
//----------------------------------------

void Process_Incoming_Text()
{
  Serial.println("Incoming text : ");
  Serial.println(Incoming_Text);

  int str_len = Incoming_Text.length() + 1;
  char char_array[str_len];
  Incoming_Text.toCharArray(char_array, str_len);

  // int len = sizeof(data);
  // Serial.println(len);
  for(int i = 8;i<10;i++)
  {
    Wire.beginTransmission(i); /* begin with device address 8 */
    Wire.write(char_array, str_len);
    Wire.endTransmission(); /* stop transmitting */
  }
  Serial.println();
  Incoming_Text = "";
}

void handle_NotFound()
{
  server.send(404, "text/plain", "Not found");
}
void handleRoot()
{
  server.send(200, "text/html", Intro_page); //--> Send web page
}

void handleControl()
{
  server.send(200, "text/html", Control_page); //--> Send web page
}

void handle_Incoming_Text()
{
  Incoming_Text = server.arg("TextContents");
  server.send(200, "text/plain", ""); //--> Send web page
  Process_Incoming_Text();
}

void setup()
{
  Serial.begin(9600);
  Wire.begin(D2, D1); // join i2c bus with SDA=D2 and SCL=D1 of NodeMCU --> D2-D1
  delay(100);

  Serial.println("Connecting to ");
  Serial.println(ssid);

  // connect to your local wi-fi network
  WiFi.begin(ssid, password);

  // check NodeMCU is connected to Wi-fi network
  while (WiFi.status() != WL_CONNECTED)
  {
    delay(1000);
    Serial.print(".");
  }
  Serial.println("");
  Serial.println("WiFi connected..!");
  Serial.print("Got IP: ");
  Serial.println(WiFi.localIP());

  server.on("/", handleRoot); //--> Routine to handle at root location. This is to display web page.
  server.on("/control", handleControl); //--> Routine to handle at root location. This is to display web page.

  server.onNotFound(handle_NotFound);
  server.on("/setText", handle_Incoming_Text); //--> Routine to handle handle_Incoming_Text Subroutines
  server.begin();                              //--> Start server
  Serial.println("HTTP Server Started");
  //------------------------------------

}
//========================================================================VOID LOOP()
void loop()
{
  server.handleClient(); //--> Handle client requests
  //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
}
